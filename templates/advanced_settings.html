<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Advanced Settings â€“ PayPilot</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.0/dist/flatly/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-dark">
    <div class="container py-5">
      {% with messages = get_flashed_messages(with_categories=True) %} 
        {% if messages %}
          {% set category, message = messages[-1] %}
            <div class="alert alert-{{category}} text-center fade show" role="alert">{{ message }}</div>
      {% endif %} 
     {% endwith %}

      <div class="row justify-content-center">
        
        <div class="col-md-10">
          <div class="card shadow-lg p-4 bg-light text-dark">
            <a href="{% if role == 'admin' %}{{ url_for('admin_dashboard') }}
            {% elif role == 'advisor' %}{{ url_for('advisor_dashboard') }}
            {% else %}{{ url_for('dashboard') }}
            {% endif %}" 
      class="btn btn-secondary" style="width:fit-content;">&larr; Back</a>            
      <div class="row g-4 align-items-center p-1">
              <h3 class="text-center p-1">Advanced Settings</h3>
              <div
                class="d-flex align-items-center justify-content-center gap-3"
              >
                <img
                  src="{{ url_for('static', filename='profile-pic.png') }}"
                  alt="Profile"
                  class="rounded-circle"
                  style="width: 10%; height: 10%"
                />
                <p>{{ user.f_name + ' ' + user.l_name }}</p>
              </div>
            </div>

            <!--Bottom forms -->
            <div class="row g-4 mt-3">
              <!--Account Info form (left)-->
              <div class="col-md-6">
                <h6>Update Your Account Information:</h6>
                <form method="POST" action="{{ url_for('advanced_settings') }}">
                  <input type="hidden" name="action" value="update-acct" />
                  <div class="form-floating mb-3">
                    <input
                      type="text"
                      class="form-control"
                      id="username"
                      name="username"
                      placeholder="Username"
                      value="{{ user.username }}"
                      required
                    />
                    <label for="username">Username</label>
                  </div>

                  <div class="form-floating mb-3">
                    <input
                      type="password"
                      class="form-control"
                      id="old_password"
                      name="old_password"
                      placeholder="Previous Password"
                      required
                    />
                    <label for="old_password">Old Password</label>
                  </div>

                  <div class="form-floating mb-3">
                    <input
                      type="password"
                      class="form-control"
                      id="password"
                      name="password"
                      placeholder="New Password"
                      required
                    />
                    <label for="password">New Password</label>
                  </div>

                  <div class="d-grid">
                    <button type="submit" class="btn btn-primary btn-lg">
                      Save Changes
                    </button>
                  </div>
                </form>
              </div>

              <!--Profile Info Form-->
              <div class="col-md-6">
                <h6>Update Your Personal Information:</h6>
                <form method="POST" action="{{ url_for('advanced_settings') }}">
                  <input type="hidden" name="action" value="update-personal" />
                  <div class="form-floating mb-3">
                    <input
                      type="email"
                      class="form-control"
                      id="email"
                      name="email"
                      value="{{ user.email }}"
                    />
                    <label for="email">Email</label>
                  </div>

                  <div class="form-floating mb-3">
                    <input
                      type="tel"
                      class="form-control"
                      id="phone"
                      name="phone"
                      value="{{user.phone}}"
                    />
                    <label for="phone">Phone Number</label>
                  </div>

                  <!-- Conditionally render form fields -->
                  {% if acct_type == "CUSTOMER" %}
                  <div class="form-floating mb-3">
                    <input
                      type="address"
                      class="form-control"
                      id="address"
                      name="address"
                      value="{{ user.addr }}"
                    />
                    <label for="address">Address</label>
                  </div>

                  <div class="form-floating mb-3">
                    <input
                      type="date"
                      class="form-control"
                      id="bdate"
                      name="bdate"
                      value="{{ user.b_date }}"
                    />
                    <label for="bdate">Birthday</label>
                  </div>
                  {% endif %}

                  <div class="d-grid">
                    <button type="submit" class="btn btn-primary btn-lg">
                      Save Changes
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>